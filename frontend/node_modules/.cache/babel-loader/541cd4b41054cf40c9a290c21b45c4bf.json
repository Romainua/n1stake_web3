{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.setupBankExtension = void 0;\n/* eslint-disable @typescript-eslint/naming-convention */\n\nconst encoding_1 = require(\"@cosmjs/encoding\");\n\nconst utils_1 = require(\"@cosmjs/utils\");\n\nconst query_1 = require(\"cosmjs-types/cosmos/bank/v1beta1/query\");\n\nconst coin_1 = require(\"cosmjs-types/cosmos/base/v1beta1/coin\");\n\nconst utils_2 = require(\"./utils\");\n\nfunction setupBankExtension(base) {\n  const rpc = utils_2.createProtobufRpcClient(base); // Use this service to get easy typed access to query methods\n  // This cannot be used for proof verification\n\n  const queryService = new query_1.QueryClientImpl(rpc);\n  return {\n    bank: {\n      balance: async (address, denom) => {\n        const {\n          balance\n        } = await queryService.Balance({\n          address: address,\n          denom: denom\n        });\n        utils_1.assert(balance);\n        return balance;\n      },\n      allBalances: async address => {\n        const {\n          balances\n        } = await queryService.AllBalances({\n          address: address\n        });\n        return balances;\n      },\n      totalSupply: async () => {\n        const {\n          supply\n        } = await queryService.TotalSupply({});\n        return supply;\n      },\n      supplyOf: async denom => {\n        const {\n          amount\n        } = await queryService.SupplyOf({\n          denom: denom\n        });\n        utils_1.assert(amount);\n        return amount;\n      },\n      verified: {\n        balance: async (address, denom) => {\n          // balance key is a bit tricker, using some prefix stores\n          // https://github.com/cosmwasm/cosmos-sdk/blob/80f7ff62f79777a487d0c7a53c64b0f7e43c47b9/x/bank/keeper/view.go#L74-L77\n          // (\"balances\", binAddress, denom)\n          // it seem like prefix stores just do a dumb concat with the keys (no tricks to avoid overlap)\n          // https://github.com/cosmos/cosmos-sdk/blob/2879c0702c87dc9dd828a8c42b9224dc054e28ad/store/prefix/store.go#L61-L64\n          // https://github.com/cosmos/cosmos-sdk/blob/2879c0702c87dc9dd828a8c42b9224dc054e28ad/store/prefix/store.go#L37-L43\n          const key = Uint8Array.from([...encoding_1.toAscii(\"balances\"), ...utils_2.toAccAddress(address), ...encoding_1.toAscii(denom)]);\n          const responseData = await base.queryVerified(\"bank\", key);\n          return responseData.length ? coin_1.Coin.decode(responseData) : null;\n        }\n      }\n    }\n  };\n}\n\nexports.setupBankExtension = setupBankExtension;","map":{"version":3,"mappings":";;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAGA;;AAmBA,SAAgBA,kBAAhB,CAAmCC,IAAnC,EAAoD;EAClD,MAAMC,GAAG,GAAGC,gCAAwBF,IAAxB,CAAZ,CADkD,CAElD;EACA;;EACA,MAAMG,YAAY,GAAG,IAAIC,uBAAJ,CAAoBH,GAApB,CAArB;EAEA,OAAO;IACLI,IAAI,EAAE;MACJC,OAAO,EAAE,OAAOC,OAAP,EAAwBC,KAAxB,KAAyC;QAChD,MAAM;UAAEF;QAAF,IAAc,MAAMH,YAAY,CAACM,OAAb,CAAqB;UAAEF,OAAO,EAAEA,OAAX;UAAoBC,KAAK,EAAEA;QAA3B,CAArB,CAA1B;QACAE,eAAOJ,OAAP;QACA,OAAOA,OAAP;MACD,CALG;MAMJK,WAAW,EAAE,MAAOJ,OAAP,IAA0B;QACrC,MAAM;UAAEK;QAAF,IAAe,MAAMT,YAAY,CAACU,WAAb,CAAyB;UAAEN,OAAO,EAAEA;QAAX,CAAzB,CAA3B;QACA,OAAOK,QAAP;MACD,CATG;MAUJE,WAAW,EAAE,YAAW;QACtB,MAAM;UAAEC;QAAF,IAAa,MAAMZ,YAAY,CAACa,WAAb,CAAyB,EAAzB,CAAzB;QACA,OAAOD,MAAP;MACD,CAbG;MAcJE,QAAQ,EAAE,MAAOT,KAAP,IAAwB;QAChC,MAAM;UAAEU;QAAF,IAAa,MAAMf,YAAY,CAACgB,QAAb,CAAsB;UAAEX,KAAK,EAAEA;QAAT,CAAtB,CAAzB;QACAE,eAAOQ,MAAP;QACA,OAAOA,MAAP;MACD,CAlBG;MAmBJE,QAAQ,EAAE;QACRd,OAAO,EAAE,OAAOC,OAAP,EAAwBC,KAAxB,KAAyC;UAChD;UACA;UACA;UACA;UACA;UACA;UACA,MAAMa,GAAG,GAAGC,UAAU,CAACC,IAAX,CAAgB,CAAC,GAAGC,mBAAQ,UAAR,CAAJ,EAAyB,GAAGtB,qBAAaK,OAAb,CAA5B,EAAmD,GAAGiB,mBAAQhB,KAAR,CAAtD,CAAhB,CAAZ;UACA,MAAMiB,YAAY,GAAG,MAAMzB,IAAI,CAAC0B,aAAL,CAAmB,MAAnB,EAA2BL,GAA3B,CAA3B;UACA,OAAOI,YAAY,CAACE,MAAb,GAAsBC,YAAKC,MAAL,CAAYJ,YAAZ,CAAtB,GAAkD,IAAzD;QACD;MAXO;IAnBN;EADD,CAAP;AAmCD;;AAzCDK","names":["setupBankExtension","base","rpc","utils_2","queryService","query_1","bank","balance","address","denom","Balance","utils_1","allBalances","balances","AllBalances","totalSupply","supply","TotalSupply","supplyOf","amount","SupplyOf","verified","key","Uint8Array","from","encoding_1","responseData","queryVerified","length","coin_1","decode","exports"],"sourceRoot":"","sources":["../../src/queries/bank.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}